#!/usr/bin/make -f

%:
	dh $@ --with python3

override_dh_auto_install:
	dh_auto_install

override_dh_python3:
	echo "--- DIAGNOSTIC: Listing all files in the current build directory ---"
	pwd
	ls -lR
	echo "--- END DIAGNOSTIC ---"

	# 1. Tell pip to look for wheels in our new vendor/wheels directory.
	# 2. Tell pip to install the 'pypotrace' package into the package's staging directory.
	#    Pip will find the correct wheel in the --find-links path and unpack it.
	pip3 install \
		--no-index \
		--find-links=file://$(CURDIR)/vendor/wheels \
		--target=$(CURDIR)/debian/rayforge/usr/lib/python3/dist-packages \
		--upgrade \
		pypotrace

	# 3. Run the original dh_python3 command, but prevent it from guessing
	#    dependencies, as we have handled our vendored one manually.
	dh_python3 --no-guessing

override_dh_clean:
	# Do nothing. Our build script already provides a clean environment.
	echo "Skipping dh_clean to preserve vendored wheels."

# 设备设置

机器设置中的设备页面允许您直接读取和应用设置到连接的设备（控制器）。这些也称为"美元设置"或 GRBL 中的 `$$` 设置。

![设备设置](/screenshots/machine-device.png)

:::warning 更改设置时请小心
错误的固件设置可能导致机器行为不可预测、失去位置，甚至损坏硬件。在更改之前始终记录原始值，并一次修改一个设置。
:::

## 概述

设备页面提供对控制器固件设置的直接访问。您可以在这里：

- 从设备读取当前设置
- 修改单个设置
- 将更改应用到设备

固件设置控制：

- **运动参数**：速度限制、加速度、校准
- **限位开关**：归零行为、软/硬限位
- **激光控制**：功率范围、激光模式启用
- **电气配置**：引脚反转、上拉
- **报告**：状态消息格式和频率

这些设置存储在您的控制器上（而不是 Rayforge 中），并在电源周期之间持续存在。

## 读取设置

点击 **从设备读取** 按钮从连接的控制器获取当前设置。这需要：

- 机器已连接
- 驱动程序支持读取设备设置

## 应用设置

修改设置后，更改将应用到设备。设备可能会：

- 暂时重启
- 断开并重新连接
- 某些更改需要电源周期

## 控制台访问

您也可以通过 G 代码控制台查看/修改设置：

**查看所有设置：**
```
$$
```

**查看单个设置：**
```
$100
```

**修改设置：**
```
$100=80.0
```

**恢复默认值：**
```
$RST=$
```

:::danger 恢复默认值会删除所有设置
`$RST=$` 命令将所有 GRBL 设置重置为出厂默认值。您将丢失任何校准和调优。请先备份您的设置！
:::

---

## 激光的关键设置

这些设置对激光操作最重要：

### $32 - 激光模式

**值：** 0 = 禁用，1 = 启用

**目的：** 在 GRBL 中启用激光特定功能

**启用时（1）：**
- 激光在 G0（快速）移动期间自动关闭
- 功率在加速/减速期间动态调整
- 防止定位时意外烧伤

**禁用时（0）：**
- 激光行为像主轴（CNC 模式）
- 快速移动期间不会关闭
- **激光使用有危险！**

:::warning 始终启用激光模式
对于激光切割机，$32 应**始终**设置为 1。禁用激光模式可能导致意外烧伤和火灾危险。
:::

### $30 和 $31 - 激光功率范围

**$30 - 最大激光功率（RPM）**
**$31 - 最小激光功率（RPM）**

**目的：** 定义 S 命令的功率范围

**典型值：**
- $30=1000, $31=0（S0-S1000 范围，最常见）
- $30=255, $31=0（S0-S255 范围，某些控制器）

:::tip 匹配 Rayforge 配置
您的[激光设置](laser)中的"最大功率"设置应与您的 $30 值匹配。如果 $30=1000，在 Rayforge 中将最大功率设置为 1000。
:::

### $130 和 $131 - 最大行程

**$130 - X 最大行程（mm）**
**$131 - Y 最大行程（mm）**

**目的：** 定义机器的工作区域

**重要原因：**
- 软限位（$20）使用这些值来防止碰撞
- 定义坐标系边界
- 必须与您的物理机器尺寸匹配

---

## 设置参考

### 步进配置（$0-$6）

控制步进电机电信号和时序。

| 设置 | 描述               | 典型值 |
| ---- | ------------------ | ------ |
| $0   | 步进脉冲时间（μs） | 10     |
| $1   | 步进空闲延迟（ms） | 25     |
| $2   | 步进脉冲反转（掩码）| 0     |
| $3   | 步进方向反转（掩码）| 0     |
| $4   | 反转步进使能引脚   | 0      |
| $5   | 反转限位引脚       | 0      |
| $6   | 反转探测引脚       | 0      |

### 限位和归零（$20-$27）

控制限位开关和归零行为。

| 设置 | 描述                     | 典型值     |
| ---- | ------------------------ | ---------- |
| $20  | 软限位启用               | 0 或 1     |
| $21  | 硬限位启用               | 0          |
| $22  | 归零循环启用             | 0 或 1     |
| $23  | 归零方向反转             | 0          |
| $24  | 归零定位进给率（mm/min） | 25         |
| $25  | 归零搜索速率（mm/min）   | 500        |
| $26  | 归零去抖动延迟（ms）     | 250        |
| $27  | 归零拉离距离（mm）       | 1.0        |

### 主轴和激光（$30-$32）

| 设置 | 描述           | 激光值   |
| ---- | -------------- | -------- |
| $30  | 最大主轴速度   | 1000.0   |
| $31  | 最小主轴速度   | 0.0      |
| $32  | 激光模式启用   | 1        |

### 轴校准（$100-$102）

定义多少步进电机步等于一毫米的移动。

| 设置 | 描述       | 备注                   |
| ---- | ---------- | ---------------------- |
| $100 | X 步/mm    | 取决于皮带轮/皮带比    |
| $101 | Y 步/mm    | 通常与 X 相同          |
| $102 | Z 步/mm    | 大多数激光不使用       |

**计算步/mm：**
```
steps/mm = (motor_steps_per_rev × microstepping) / (pulley_teeth × belt_pitch)
```

**示例：** 200 步/转，16 微步，20 齿皮带轮，GT2 皮带：
```
steps/mm = (200 × 16) / (20 × 2) = 3200 / 40 = 80
```

### 轴速度和加速度（$110-$122）

| 设置 | 描述                 | 典型值   |
| ---- | -------------------- | -------- |
| $110 | X 最大速率（mm/min） | 5000.0   |
| $111 | Y 最大速率（mm/min） | 5000.0   |
| $112 | Z 最大速率（mm/min） | 500.0    |
| $120 | X 加速度（mm/sec²）  | 500.0    |
| $121 | Y 加速度（mm/sec²）  | 500.0    |
| $122 | Z 加速度（mm/sec²）  | 100.0    |

### 轴行程（$130-$132）

| 设置 | 描述             | 备注             |
| ---- | ---------------- | ---------------- |
| $130 | X 最大行程（mm） | 工作区域宽度     |
| $131 | Y 最大行程（mm） | 工作区域深度     |
| $132 | Z 最大行程（mm） | Z 行程（如适用） |

---

## 常见配置示例

### 典型二极管激光（300×400mm）

```gcode
$0=10          ; 步进脉冲 10μs
$1=255         ; 步进空闲延迟 255ms
$2=0           ; 无步进反转
$3=0           ; 无方向反转
$4=0           ; 无使能反转
$5=0           ; 无限位反转
$10=1          ; 报告 WPos
$11=0.010      ; 连接偏差 0.01mm
$12=0.002      ; 圆弧容差 0.002mm
$13=0          ; 报告 mm
$20=1          ; 软限位启用
$21=0          ; 硬限位禁用
$22=1          ; 归零启用
$23=0          ; 归零到最小
$24=50.0       ; 归零进给 50mm/min
$25=1000.0     ; 归零搜索 1000mm/min
$26=250        ; 归零去抖动 250ms
$27=2.0        ; 归零拉离 2mm
$30=1000.0     ; 最大功率 S1000
$31=0.0        ; 最小功率 S0
$32=1          ; 激光模式开
$100=80.0      ; X 步/mm
$101=80.0      ; Y 步/mm
$102=80.0      ; Z 步/mm
$110=5000.0    ; X 最大速率
$111=5000.0    ; Y 最大速率
$112=500.0     ; Z 最大速率
$120=500.0     ; X 加速度
$121=500.0     ; Y 加速度
$122=100.0     ; Z 加速度
$130=400.0     ; X 最大行程
$131=300.0     ; Y 最大行程
$132=0.0       ; Z 最大行程
```

---

## 备份设置

### 备份过程

1. **通过 Rayforge：**
   - 打开设备设置面板
   - 点击"导出设置"
   - 将文件保存为 `grbl-backup-YYYY-MM-DD.txt`

2. **通过控制台：**
   - 发送 `$$` 命令
   - 将所有输出复制到文本文件
   - 保存并注明日期

### 恢复过程

1. 打开备份文件
2. 通过控制台发送每一行（`$100=80.0` 等）
3. 使用 `$$` 命令验证

:::tip 定期备份
在校准或调优后备份您的设置。将备份存储在安全位置。
:::

---

## 另请参阅

- [常规设置](general) - 机器名称和速度设置
- [激光设置](laser) - 激光头配置
- [连接故障排除](../troubleshooting/connection) - 修复连接问题

## 外部资源

- [GRBL v1.1 配置](https://github.com/gnea/grbl/wiki/Grbl-v1.1-Configuration)
- [GRBL v1.1 命令](https://github.com/gnea/grbl/wiki/Grbl-v1.1-Commands)
- [Grbl_ESP32 文档](https://github.com/bdring/Grbl_Esp32/wiki)

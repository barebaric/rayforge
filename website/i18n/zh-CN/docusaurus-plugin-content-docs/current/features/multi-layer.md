# 多层工作流程

Rayforge 的多层系统允许您将复杂作业组织为单独的处理阶段，每个阶段都有自己的操作和设置。这对于结合不同过程（如雕刻和切割）或处理多种材料至关重要。

## 什么是图层？

Rayforge 中的**图层**是：

- 工件（导入的形状、图像、文本）的**容器**
- 定义如何处理这些工件的**工作流程**
- 作业期间顺序处理的**步骤**

**关键概念：** 图层按顺序处理，一个接一个，允许您控制操作序列。

:::note 图层和工件
图层包含一个或多个工件。当导入带图层的 SVG 文件时，设计的每个图层成为 Rayforge 中的单独图层。这使您能够完全按照创建的方式保持设计组织。
:::


---

## 为什么要使用多层？

### 常见用例

**1. 先雕刻后切割**

最常见的多层工作流程：

- **图层 1：** 光栅雕刻设计
- **图层 2：** 轮廓切割轮廓

**为什么要分开图层？**

- 首先雕刻确保零件在雕刻期间不会移动
- 最后切割防止零件在雕刻完成前掉落
- 每个操作有不同的功率/速度设置

**2. 多次切割**

对于厚材料：

- **图层 1：** 中等功率的第一遍
- **图层 2：** 全功率的第二遍（相同几何）
- **图层 3：** 如需要的可选第三遍

**好处：**

- 与单次高功率遍相比减少烧焦
- 每个图层可以有不同的速度/功率设置

**3. 多材料项目**

一个作业中的不同材料：

- **图层 1：** 切割亚克力零件
- **图层 2：** 雕刻木材零件
- **图层 3：** 标记金属零件

**要求：**

- 每个图层针对床的不同区域
- 每种材料不同的速度/功率/对焦

**4. SVG 图层导入**

导入带现有图层结构的 SVG 文件：

- **图层 1：** 来自 SVG 的雕刻元素
- **图层 2：** 来自 SVG 的切割元素
- **图层 3：** 来自 SVG 的划线元素

**工作流程：**

- 导入具有图层的 SVG 文件
- 在导入对话框中启用"使用原始矢量"
- 从检测到的图层列表中选择要导入的图层
- 每个图层成为 Rayforge 中的单独图层

**要求：**

- SVG 文件必须使用图层（在 Inkscape 或类似软件中创建）
- 导入时启用"使用原始矢量"
- 从设计软件保留图层名称

---

## 创建和管理图层

### 添加新图层

1. 在图层面板中**点击 "+" 按钮**
2. **命名图层**具有描述性（例如，"雕刻图层"、"切割图层"）
3. **图层出现**在图层列表中

**默认：** 新文档从一个图层开始。

### 图层属性

每个图层具有：

| 属性         | 描述                                   |
| ------------ | -------------------------------------- |
| **名称**     | 图层列表中显示的名称                   |
| **可见**     | 切换画布和预览中的可见性               |
| **材料项目** | 可选的材料关联                         |
| **工作流程** | 应用于此图层中工件的操作               |
| **工件**     | 此图层中包含的形状/图像                |

:::note 图层作为容器
图层是工件的容器。当导入带图层的 SVG 文件时，设计的每个图层成为 Rayforge 中的单独图层。
:::


### 重新排序图层

**执行顺序 = 图层列表中的顺序（从上到下）**

重新排序：

1. 在图层面板中**拖放**图层
2. **顺序很重要** - 图层从上到下执行

**示例：**

```
图层面板：
1. 雕刻图层     首先执行
2. 划线图层     第二执行
3. 切割图层     最后执行（推荐）
```

### 删除图层

1. 在图层面板中**选择图层**
2. **点击删除按钮**或按 Delete
3. **确认删除**（图层中的所有工件被删除）

:::warning 删除是永久的
删除图层会删除其所有工件和工作流程设置。如果意外删除，请使用撤销。
:::


---

## 将工件分配给图层

### 手动分配

1. **导入或创建**工件
2. **将工件拖动**到图层面板中所需的图层
3. **或使用属性面板**更改工件的图层

### SVG 图层导入

当启用"使用原始矢量"导入 SVG 文件时：

1. 在导入对话框中**启用"使用原始矢量"**
2. **Rayforge 检测图层**从您的 SVG 文件
3. **选择哪些图层**使用图层开关导入
4. **每个选定的图层**成为带自己工件的单独图层

:::note 图层检测
Rayforge 自动从 SVG 文件检测图层。您在设计软件中创建的每个图层将作为 Rayforge 中的单独图层出现。
:::


:::note 仅矢量导入
图层选择仅在直接矢量导入时可用。
使用描绘模式时，整个 SVG 作为一个工件处理。
:::


### 在图层之间移动工件

**拖放：**

- 在画布或文档面板中选择工件
- 拖动到图层面板中的目标图层

**剪切和粘贴：**

- 从当前图层剪切工件（Ctrl+X）
- 选择目标图层
- 粘贴（Ctrl+V）

### SVG 导入对话框

导入 SVG 文件时，导入对话框提供影响图层处理的选项：

**导入模式：**

- **使用原始矢量：** 保留矢量路径和图层结构。
  启用时，出现"图层"部分显示文件中的所有图层。
- **描绘模式：** 将 SVG 转换为位图并描绘轮廓。
  此模式下禁用图层选择。

**图层部分（仅矢量导入）：**

- 显示 SVG 文件中的所有图层
- 每个图层有切换开关以启用/禁用导入
- 从设计软件保留图层名称
- 仅选定的图层作为单独图层导入

:::tip 为图层导入准备 SVG 文件
要使用 SVG 图层导入，请在 Inkscape 等软件中使用图层创建设计。使用图层面板组织设计，Rayforge 将保留该结构。
:::


---

## 图层工作流程

每个图层有一个**工作流程**，定义如何处理其工件。

### 设置图层工作流程

对于每个图层，您选择操作类型并配置其设置：

**操作类型：**

- **轮廓** - 沿轮廓（用于切割或划线）
- **光栅雕刻** - 雕刻图像并填充区域
- **深度雕刻** - 创建可变深度雕刻

**可选增强：**

- **标签** - 在切割期间保持零件就位的小桥接
- **过扫描** - 为更干净的边缘将切割延伸到形状之外
- **缝隙调整** - 补偿激光的切割宽度

### 常见图层设置

**雕刻图层：**

- 操作：光栅雕刻
- 设置：300-500 DPI，中等速度
- 通常不需要额外选项

**切割图层：**

- 操作：轮廓切割
- 选项：标签（保持零件），过扫描（用于干净的边缘）
- 设置：较慢的速度，较高的功率

**划线图层：**

- 操作：轮廓（轻功率，不切穿）
- 设置：低功率，快速度
- 目的：折叠线，装饰线

---

## 图层可见性

控制哪些图层在画布和预览中显示：

### 画布可见性

- 图层面板中的**眼睛图标**切换可见性
- **隐藏图层：**
  - 不在 2D 画布中显示
  - 不在 3D 预览中显示
  - **仍包含在生成的 G 代码中**

**用例：**

- 定位切割图层时隐藏复杂的雕刻图层
- 处理特定图层时整理画布
- 一次专注于一个图层

### 可见性与启用

| 状态                  | 画布 | 预览 | G 代码 |
| --------------------- | ---- | ---- | ------ |
| **可见且启用**        | 是   | 是   | 是     |
| **隐藏且启用**        | 否   | 否   | 是     |
| **可见且禁用**        | 是   | 是   | 否     |
| **隐藏且禁用**        | 否   | 否   | 否     |

:::note 禁用图层
:::

要暂时从作业中排除图层而不删除它，请关闭图层操作或在图层设置中禁用它。

---

## 图层执行顺序

### 图层如何处理

作业执行期间，Rayforge 从上到下按顺序处理每个图层。在每个图层内，所有工件在移动到下一个图层之前处理。

### 顺序很重要

**错误的顺序：**

```
1. 切割图层
2. 雕刻图层
```

**问题：** 切割的零件可能在雕刻前掉落或移动！

**正确的顺序：**

```
1. 雕刻图层
2. 切割图层
```

**为什么：** 雕刻在零件仍附着时发生，然后切割释放它。

### 多次遍

对于厚材料，创建多个切割图层：

```
1. 雕刻图层
2. 切割图层（第 1 遍）- 50% 功率
3. 切割图层（第 2 遍）- 75% 功率
4. 切割图层（第 3 遍）- 100% 功率
```

**提示：** 对所有切割遍使用相同的几何（复制图层）。

---

## 高级技术

### 按材料分组图层

运行混合作业时使用图层按材料组织：

```
材料 1（3mm 亚克力）：
  - 亚克力雕刻图层
  - 亚克力切割图层

材料 2（3mm 胶合板）：
  - 木材雕刻图层
  - 木材切割图层
```

**工作流程：**

1. 处理所有材料 1 图层
2. 更换材料
3. 处理所有材料 2 图层

**替代方案：** 为不同材料使用单独的文档。

### 图层之间暂停

您可以配置 Rayforge 在图层之间暂停。这在需要以下情况时很有用：

- 作业中途更换材料
- 继续前检查进度
- 为不同操作调整对焦

要设置图层暂停，请使用机器设置中的钩子功能。

### 特定于图层的设置

每个图层的工作流程可以有唯一的设置：

| 图层   | 操作   | 速度        | 功率 | 次数 |
| ------ | ------ | ----------- | ---- | ---- |
| 雕刻   | 光栅   | 300 mm/min  | 20%  | 1    |
| 划线   | 轮廓   | 500 mm/min  | 10%  | 1    |
| 切割   | 轮廓   | 100 mm/min  | 90%  | 2    |

---

## 最佳实践

### 命名约定

**好的图层名称：**

- "雕刻 - 标志"
- "切割 - 外轮廓"
- "划线 - 折叠线"
- "第 1 遍 - 粗切"
- "第 2 遍 - 精切"

**差的图层名称：**

- "图层 1"、"图层 2"（不具描述性）
- 长描述（保持简洁）

### 图层组织

1. **从上到下 = 执行顺序**
2. **雕刻在切割之前**（一般规则）
3. **分组相关操作**（所有切割、所有雕刻）
4. **使用可见性**专注于当前工作
5. **删除未使用的图层**以保持项目干净

### 为图层导入准备 SVG 文件

**为导入 SVG 图层获得最佳效果：**

1. 在设计软件中使用图层面板组织设计
2. 为每个图层分配有意义的名称（例如，"雕刻"、"切割"）
3. **保持图层平坦** - 避免将图层放在其他图层内
4. **保存文件**并导入 Rayforge
5. 通过检查导入对话框**验证图层检测**

Rayforge 与在支持图层的 Inkscape 或类似矢量设计软件中创建的 SVG 文件配合最佳。

### 性能

**许多图层：**

- 无显著性能影响
- 复杂作业常见 10-20 个图层
- 逻辑组织，而不是最小化图层数量

**如需要简化：**

- 尽可能将类似操作组合到一个图层
- 使用较少的光栅雕刻（最资源密集）

---

## 故障排除

### 图层不生成 G 代码

**问题：** 图层出现在文档中但不在生成的 G 代码中。

**解决方案：**

1. **检查图层有工件** - 空图层被跳过
2. **检查工作流程已配置** - 图层需要操作
3. **验证操作设置** - 功率 > 0，有效速度等。
4. **检查工件可见性** - 隐藏工件可能不处理
5. **重新生成 G 代码** - 进行小更改以强制重新生成

### 图层顺序错误

**问题：** 操作以意外顺序执行。

**解决方案：** 在图层面板中重新排序图层。记住：顶部 = 第一。

### 预览中图层重叠

**问题：** 多个图层在预览中显示重叠内容。

**澄清：** 如果图层共享相同的 XY 区域，这是正常的。

**解决方案：**

- 使用图层可见性暂时隐藏其他图层
- 检查 3D 预览以查看深度/顺序
- 验证这是有意的（例如，雕刻然后切割相同形状）

### 工件在错误的图层

**问题：** 工件被分配给错误的图层。

**解决方案：** 将工件拖动到图层面板或文档树中的正确图层。

### SVG 图层未检测到

**问题：** 导入 SVG 文件但导入对话框中没有图层出现。

**解决方案：**

1. **检查 SVG 结构** - 在 Inkscape 或类似软件中打开文件
   以验证它有图层
2. **启用"使用原始矢量"** - 图层选择仅在此
   导入模式下可用
3. **验证设计有图层** - 确保在设计软件中创建了图层，
   不仅仅是组
4. **检查嵌套图层** - 其他图层内的图层可能不会
   正确检测
5. **重新保存文件** - 有时使用设计软件的当前版本
   重新保存有帮助

### SVG 图层导入显示错误内容

**问题：** 导入的图层显示来自其他图层的内容或为空。

**解决方案：**

1. **检查图层选择** - 验证
   导入对话框中启用了正确的图层
2. **验证设计** - 在设计软件中打开原始文件
   以确认每个图层包含正确的内容
3. **检查共享元素** - 出现在多个图层中的元素
   可能导致混淆
4. **尝试描绘模式** - 如果矢量导入有
   问题，使用描绘模式作为备用

---

## 相关页面

- [操作](./operations/contour) - 图层工作流程的操作类型
- [模拟模式](./simulation-mode) - 预览多层执行
- [宏和钩子](../machine/hooks-macros) - 用于自动化的图层级钩子
- [3D 预览](../ui/3d-preview) - 可视化图层堆栈

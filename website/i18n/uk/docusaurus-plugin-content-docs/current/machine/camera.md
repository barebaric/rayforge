# Інтеграція камери

Rayforge підтримує інтеграцію USB-камери для точного вирівнювання та позиціонування матеріалу. Функція накладання камери дозволяє бачити точно, де ваш лазер буде різати або гравірувати на матеріалі, усуваючи здогадки та зменшуючи відходи матеріалу.

![Налаштування камери](/screenshots/machine-camera.png)

## Огляд

Інтеграція камери забезпечує:

- **Накладання живого відео** на полотні, показуючи ваш матеріал у реальному часі
- **Вирівнювання зображення** для калібрування позиції камери відносно лазера
- **Візуальне позиціонування** для точного розміщення завдань на нерівних або попередньо позначених матеріалах
- **Попередній перегляд матеріалу** перед запуском завдань
- **Підтримка кількох камер** для різних конфігурацій машин

:::порада Випадки використання

- Вирівнювання різів на попередньо надрукованих матеріалах
- Робота з матеріалами неправильної форми
- Точне розміщення гравірування на існуючих об'єктах
- Зменшення тестових різів та відходів матеріалу
  :::

---

## Налаштування камери

### Вимоги до обладнання

**Сумісні камери:**

- USB веб-камери (найпоширеніші)
- Вбудовані камери ноутбуків (якщо Rayforge запущено на ноутбуці поруч з машиною)
- Будь-яка камера, що підтримується Video4Linux2 (V4L2) на Linux або DirectShow на Windows

**Рекомендоване налаштування:**

- Камера, закріплена над робочою областю з чітким видом матеріалу
- Послідовні умови освітлення
- Камера позиціонована для захвату робочої області лазера
- Надійне кріплення для запобігання русі камери

### Додавання камери

1. **Підключіть камеру** до комп'ютера через USB

2. **Відкрийте налаштування камери:**
   - Перейдіть до **Налаштування Налаштування Камера**
   - Або використовуйте кнопку камери на панелі інструментів

3. **Додайте нову камеру:**
   - Натисніть кнопку "+"
   - Введіть описову назву (наприклад, "Верхня камера", "Камера робочої області")
   - Виберіть пристрій зі списку
     - На Linux: `/dev/video0`, `/dev/video1` тощо.
     - На Windows: Camera 0, Camera 1 тощо.

4. **Увімкніть камеру:**
   - Перемкніть перемикач увімкнення камери
   - Живе зображення з'явиться на вашому полотні

5. **Налаштуйте параметри камери:**
   - **Яскравість:** Налаштуйте, якщо матеріал занадто темний/світлий
   - **Контраст:** Підсилити видимість країв
   - **Прозорість:** Контроль непрозорості накладання (рекомендується 20-50%)
   - **Баланс білого:** Авто або ручна температура Кельвіна

---

## Вирівнювання камери

Вирівнювання камери калібрує співвідношення між пікселями камери та реальними координатами, забезпечуючи точне позиціонування.

### Чому необхідне вирівнювання

Камера бачить робочу область зверху, але зображення може бути:

- Повернуте відносно осей машини
- Масштабоване по-різному в напрямках X та Y
- Спотворене перспективою об'єктива

Вирівнювання створює матрицю трансформації, яка відображає пікселі камери в координати машини.

### Процедура вирівнювання

1. **Відкрийте діалог вирівнювання:**
   - Натисніть кнопку вирівнювання камери на панелі інструментів
   - Або перейдіть до **Камера Вирівняти камеру**

2. **Розмістіть маркери вирівнювання:**
   - Вам потрібно щонайменше 3 опорні точки (4 рекомендується для кращої точності)
   - Точки вирівнювання мають бути розподілені по робочій області
   - Використовуйте відомі позиції, такі як:
     - Позиція home машини
     - Позначки лінійки
     - Попередньо вирізані отвори вирівнювання
     - Калібрувальна сітка

3. **Позначте точки зображення:**
   - Клацніть на зображенні камери, щоб розмістити точку у відомому місці
   - З'явиться віджет з координатами точки
   - Повторіть для кожної опорної точки

4. **Введіть світові координати:**
   - Для кожної точки зображення введіть реальні координати X/Y в мм
   - Це фактичні координати машини, де знаходиться кожна точка
   - Виміряйте точно лінійкою або використовуйте відомі позиції машини

5. **Застосуйте вирівнювання:**
   - Натисніть "Застосувати" для розрахунку трансформації
   - Накладання камери тепер буде правильно вирівняно

6. **Перевірте вирівнювання:**
   - Перемістіть лазерну головку у відому позицію
   - Перевірте, що точка лазера вирівнюється з очікуваною позицією у видові камери
   - Точно налаштуйте повторним вирівнюванням за потреби

### Поради з вирівнювання

:::порада Найкращі практики
- Використовуйте точки в кутах вашої робочої області для максимального покриття
- Уникайте скупчення точок в одній області
- Вимірюйте світові координати ретельно - точність тут визначає загальну якість вирівнювання
- Повторно вирівнюйте, якщо перемістили камеру або змінили дистанцію фокусування
- Зберігайте ваше вирівнювання - воно зберігається між сесіями
  :::

**Приклад робочого процесу вирівнювання:**

1. Перемістіть лазер у позицію home (0, 0) і позначте на камері
2. Перемістіть лазер у (100, 0) і позначте на камері
3. Перемістіть лазер у (100, 100) і позначте на камері
4. Перемістіть лазер у (0, 100) і позначте на камері
5. Введіть точні координати для кожної точки
6. Застосуйте та перевірте

---

## Використання накладання камери

Після вирівнювання накладання камери допомагає точно позиціонувати завдання.

### Увімкнення/вимкнення накладання

- **Перемкнути камеру:** Натисніть іконку камери на панелі інструментів
- **Налаштувати прозорість:** Використовуйте повзунок у налаштуваннях камери (20-50% добре працює)
- **Оновити зображення:** Камера оновлюється безперервно, поки увімкнена

### Позиціонування завдань за допомогою камери

**Робочий процес для точного розміщення:**

1. **Увімкніть накладання камери**, щоб бачити ваш матеріал

2. **Імпортуйте ваш дизайн** (SVG, DXF тощо)

3. **Позиціонуйте дизайн** на полотні:
   - Перетягуйте дизайн для вирівнювання з елементами, видимими на камері
   - Використовуйте масштабування для перегляду дрібних деталей
   - Обертайте/масштабуйте за потреби

4. **Попередній перегляд вирівнювання:**
   - Використовуйте [Режим симуляції](../features/simulation-mode) для візуалізації
   - Перевірте, що різи/гравірування будуть там, де ви очікуєте

5. **Обведіть завдання** для перевірки позиціонування перед запуском

6. **Запустіть завдання** з впевненістю

### Приклад: Гравірування на попередньо надрукованій картці

1. Розмістіть надруковану картку на робочому столі лазера
2. Увімкніть накладання камери
3. Імпортуйте ваш дизайн гравірування
4. Перетягніть та позиціонуйте дизайн для вирівнювання з надрукованими елементами
5. Точно налаштуйте позицію стрілками клавіатури
6. Обведіть для перевірки
7. Запустіть завдання

---

## Довідник налаштувань камери

### Налаштування пристрою

| Налаштування       | Опис                     | Значення                               |
| ------------- | ------------------------------- | ------------------------------------ |
| **Назва**      | Описова назва для камери | Будь-який текст                             |
| **ID пристрою** | Системний ідентифікатор пристрою        | `/dev/video0` (Linux), `0` (Windows) |
| **Увімкнено**   | Активний стан камери             | Увімк/Вимк                               |

### Налаштування зображення

| Налаштування           | Опис                  | Діапазон                             |
| ----------------- | ---------------------------- | --------------------------------- |
| **Яскравість**    | Загальна яскравість зображення     | -100 до +100                      |
| **Контраст**      | Визначення країв та контраст | 0 до 100                          |
| **Прозорість**  | Непрозорість накладання на полотні    | 0% (непрозоре) до 100% (прозоре) |
| **Баланс білого** | Корекція колірної температури | Авто або 2000-10000K               |

### Дані вирівнювання

| Властивість                  | Опис                         |
| ------------------------- | ----------------------------------- |
| **Точки зображення**          | Піксельні координати на зображенні камери   |
| **Світові точки**          | Реальні координати машини (мм) |
| **Матриця трансформації** | Розраховане відображення (внутрішнє)       |

---

## Розширені функції

### Калібрування камери (корекція дисторсії об'єктива)

Для точної роботи ви можете відкалібрувати камеру для корекції бочкової/подушковидної дисторсії:

1. **Роздрукуйте шахівницю** (наприклад, сітка 8×6 з квадратами 25мм)
2. **Зробіть 10+ зображень** шахівниці з різних кутів/позицій
3. **Використовуйте інструменти калібрування OpenCV** для розрахунку матриці камери та коефіцієнтів дисторсії
4. **Застосуйте калібрування** в Rayforge (розширені налаштування)

:::примітка Коли калібрувати
Корекція дисторсії об'єктива необхідна лише для:

- Ширококутних об'єктивів з помітною бочковою дисторсією
- Точної роботи, що вимагає точності <1мм
- Великих робочих областей, де дисторсія накопичується

Більшість стандартних веб-камер добре працюють без калібрування для типової лазерної роботи.
:::

### Кілька камер

Rayforge підтримує кілька камер для різних видів або машин:

- Додайте кілька камер у налаштуваннях
- Кожна камера може мати незалежне вирівнювання
- Перемикайтеся між камерами за допомогою селектора камер
- Випадки використання:
  - Вид зверху + вид збоку для 3D-об'єктів
  - Різні камери для різних машин
  - Ширококутна + детальна камера

---

## Виправлення проблем

### Камера не виявлена

**Проблема:** Камера не з'являється в списку пристроїв.

**Рішення:**

**Linux:**
Перевірте, чи камера розпізнається системою:

```bash
# Список відеопристроїв
ls -l /dev/video*

# Перевірте камеру з v4l2
v4l2-ctl --list-devices

# Перевірте іншим додатком
cheese  # або VLC тощо.
```

**Для користувачів Snap:**

```bash
# Надайте доступ до камери
sudo snap connect rayforge:camera
```

**Windows:**

- Перевірте Device Manager на наявність камери в "Cameras" або "Imaging devices"
- Переконайтеся, що жоден інший додаток не використовує камеру (закрийте Zoom, Skype тощо)
- Спробуйте інший USB-порт
- Оновіть драйвери камери

### Камера показує чорний екран

**Проблема:** Камера виявлена, але не показує зображення.

**Можливі причини:**

1. **Камера використовується іншим додатком** - Закрийте інші відеододатки
2. **Невірний пристрій вибрано** - Спробуйте різні ID пристроїв
3. **Дозволи камери** - На Linux Snap переконайтеся, що інтерфейс камери підключено
4. **Апаратна проблема** - Перевірте камеру іншим додатком

**Рішення:**

```bash
# Linux: Звільніть пристрій камери
sudo killall cheese  # або інші додатки камери

# Перевірте, який процес використовує камеру
sudo lsof /dev/video0
```

### Вирівнювання неточне

**Проблема:** Накладання камери не відповідає реальній позиції лазера.

**Діагностика:**

1. **Недостатньо точок вирівнювання** - Використовуйте щонайменше 4 точки
2. **Помилки вимірювання** - Перевірте світові координати
3. **Камера перемістилася** - Повторно вирівняйте, якщо позиція камери змінилася
4. **Нелінійна дисторсія** - Може знадобитися калібрування об'єктива

**Покращення точності:**

- Використовуйте більше точок вирівнювання (6-8 для дуже великих областей)
- Розподіліть точки по всій робочій області
- Вимірюйте світові координати дуже ретельно
- Використовуйте команди переміщення машини для точного позиціонування лазера у відомих координатах
- Повторно вирівнюйте після будь-яких коригувань камери

### Погана якість зображення

**Проблема:** Зображення камери розмите, темне або пересвічене.

**Рішення:**

1. **Налаштуйте яскравість/контраст** у налаштуваннях камери
2. **Покращіть освітлення** - Додайте послідовне освітлення робочої області
3. **Очистіть об'єктив камери** - Пил та сміття знижують чіткість
4. **Перевірте фокус** - Автофокус може працювати погано; використовуйте ручний, якщо можливо
5. **Тимчасово зменшіть прозорість**, щоб чіткіше бачити зображення камери
6. **Спробуйте різні налаштування балансу білого**

### Затримка або переривчастість камери

**Проблема:** Живе зображення камери переривчасте або затримане.

**Рішення:**

- Знизьте роздільну здатність камери у налаштуваннях пристрою (якщо доступно)
- Закрийте інші додатки, що використовують CPU/GPU
- Оновіть графічні драйвери
- На Linux переконайтеся, що використовується бекенд V4L2 (автоматично в Rayforge)
- Вимикайте камеру, коли не потрібна, для економії ресурсів

---

## Пов'язані сторінки

- [Режим симуляції](../features/simulation-mode) - Попередній перегляд виконання з накладанням камери
- [3D перегляд](../ui/3d-preview) - Візуалізація завдань у 3D
- [Обведення завдань](../features/framing-your-job) - Перевірка позиції завдання
- [Загальні налаштування](general) - Конфігурація машини

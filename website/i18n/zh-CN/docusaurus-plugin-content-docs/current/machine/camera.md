# 相机集成

Rayforge 支持 USB 相机集成，用于精确的材料对齐和定位。相机叠加功能允许您准确看到激光将在材料上的何处切割或雕刻，消除猜测并减少材料浪费。

![相机设置](/screenshots/machine-camera.png)

## 概述

相机集成提供：

- 画布上的**实时视频叠加**，实时显示您的材料
- **图像对齐**以校准相机相对于激光的位置
- **视觉定位**以准确地将作业放置在不规则或预标记的材料上
- 运行作业前的**材料预览**
- **多相机支持**用于不同的机器设置

:::tip 用例

- 在预打印材料上对齐切割
- 处理不规则形状的材料
- 在现有物体上精确放置雕刻
- 减少测试切割和材料浪费
  :::

---

## 相机设置

### 硬件要求

**兼容的相机：**

- USB 网络摄像头（最常见）
- 笔记本电脑内置相机（如果在靠近机器的笔记本电脑上运行 Rayforge）
- Linux 上 Video4Linux2（V4L2）支持的任何相机或 Windows 上的 DirectShow

**推荐的设置：**

- 相机安装在工作区域上方，视野清晰
- 一致的照明条件
- 相机定位以捕获激光工作区域
- 安全安装以防止相机移动

### 添加相机

1. **连接相机**到您的计算机，通过 USB

2. **打开相机设置：**
   - 导航到 **设置 → 首选项 → 相机**
   - 或使用相机工具栏按钮

3. **添加新相机：**
   - 点击 "+" 按钮添加相机
   - 输入描述性名称（例如，"顶部相机"、"工作区域相机"）
   - 从下拉菜单中选择设备
     - Linux 上：`/dev/video0`、`/dev/video1` 等
     - Windows 上：相机 0、相机 1 等

4. **启用相机：**
   - 切换相机启用开关
   - 实时画面应显示在画布上

5. **调整相机设置：**
   - **亮度**：如果材料太暗/太亮则调整
   - **对比度**：增强边缘可见性
   - **透明度**：控制叠加不透明度（建议 20-50%）
   - **白平衡**：自动或手动开尔文温度

---

## 相机对齐

相机对齐校准相机像素与现实世界坐标之间的关系，实现精确定位。

### 为什么需要校准

相机从上方看到工作区域，但图像可能是：

- 相对于机器轴旋转
- X 和 Y 方向缩放不同
- 镜头透视扭曲

对齐创建一个转换矩阵，将相机像素映射到机器坐标。

### 对齐过程

1. **打开对齐对话框：**
   - 点击工具栏中的相机对齐按钮
   - 或转到 **相机 → 对齐相机**

2. **放置对齐标记：**
   - 您需要至少 3 个参考点（推荐 4 个以获得更好的精度）
   - 对齐点应分布在工作区域中
   - 使用已知位置，如：
     - 机器原点位置
     - 尺子标记
     - 预切割对齐孔
     - 校准网格

3. **标记图像点：**
   - 点击相机图像在已知位置放置点
   - 出现气泡小部件显示点坐标
   - 对每个参考点重复

4. **输入世界坐标：**
   - 对于每个图像点，输入真实的 X/Y 坐标（mm）
   - 这些是每个点所在的实际机器坐标
   - 用尺子准确测量或使用已知的机器位置

5. **应用对齐：**
   - 点击"应用"计算转换
   - 相机叠加现在将正确对齐

6. **验证对齐：**
   - 将激光头移动到已知位置
   - 检查激光点与相机视图中的预期位置对齐
   - 如需要，通过重新对齐进行微调

### 对齐提示

:::tip 最佳实践
- 使用工作区域角落的点以获得最大覆盖
- 避免在一个区域聚集点
- 仔细测量世界坐标 - 这里的准确性决定了整体对齐质量
- 如果移动相机或更改对焦距离，请重新对齐
- 保存您的对齐 - 它在会话之间持续存在
  :::

**示例对齐工作流程：**

1. 将激光移动到原点位置 (0, 0) 并在相机中标记
2. 将激光移动到 (100, 0) 并在相机中标记
3. 将激光移动到 (100, 100) 并在相机中标记
4. 将激光移动到 (0, 100) 并在相机中标记
5. 为每个点输入精确坐标
6. 应用并验证

---

## 使用相机叠加

对齐后，相机叠加帮助准确定位作业。

### 启用/禁用叠加

- **切换相机：** 点击工具栏中的相机图标
- **调整透明度：** 使用相机设置中的滑块（20-50% 效果很好）
- **刷新图像：** 启用时相机持续更新

### 使用相机定位作业

**精确定位的工作流程：**

1. **启用相机叠加**以查看您的材料

2. **导入您的设计**（SVG、DXF 等）

3. **在画布上定位设计：**
   - 拖动设计以与相机中可见的特征对齐
   - 使用缩放查看细节
   - 根据需要旋转/缩放

4. **预览对齐：**
   - 使用[模拟模式](../features/simulation-mode)进行可视化
   - 检查切割/雕刻将在您预期的位置

5. **框选作业**以在运行前验证定位

6. **自信地运行作业**

### 示例：在预打印卡片上雕刻

1. 将打印的卡片放在激光床上
2. 启用相机叠加
3. 导入您的雕刻设计
4. 拖动并定位设计以与打印特征对齐
5. 使用箭头键微调位置
6. 框选以验证
7. 运行作业

---

## 相机设置参考

### 设备设置

| 设置          | 描述                   | 值                                   |
| ------------- | ---------------------- | ------------------------------------ |
| **名称**      | 相机的描述性名称       | 任何文本                             |
| **设备 ID**   | 系统设备标识符         | `/dev/video0`（Linux），`0`（Windows）|
| **启用**      | 相机活动状态           | 开/关                                |

### 图像调整

| 设置            | 描述                   | 范围                           |
| --------------- | ---------------------- | ------------------------------ |
| **亮度**        | 整体图像亮度           | -100 到 +100                   |
| **对比度**      | 边缘定义和对比度       | 0 到 100                       |
| **透明度**      | 画布上的叠加不透明度   | 0%（不透明）到 100%（透明）    |
| **白平衡**      | 色温校正               | 自动或 2000-10000K             |

### 对齐数据

| 属性                   | 描述                         |
| ---------------------- | ---------------------------- |
| **图像点**             | 相机图像中的像素坐标         |
| **世界点**             | 真实世界的机器坐标（mm）     |
| **转换矩阵**           | 计算的映射（内部）           |

---

## 高级功能

### 相机校准（镜头畸变校正）

对于精密工作，您可以校准相机以校正桶形/枕形畸变：

1. **打印棋盘格图案**（例如，8×6 网格，25mm 方格）
2. **捕获 10+ 张图像**，从不同角度/位置的图案
3. **使用 OpenCV 校准工具**计算相机矩阵和畸变系数
4. **在 Rayforge 中应用校准**（高级设置）

:::note 何时校准
镜头畸变校正仅在以下情况下必要：

- 具有明显桶形畸变的广角镜头
- 需要 <1mm 精度的精密工作
- 畸变累积的大型工作区域

大多数标准网络摄像头在典型的激光工作中无需校准即可正常工作。
:::

### 多相机

Rayforge 支持多个相机用于不同视图或机器：

- 在首选项中添加多个相机
- 每个相机可以有独立的对齐
- 使用相机选择器在相机之间切换
- 用例：
  - 顶视图 + 侧视图用于 3D 物体
  - 不同机器的不同相机
  - 广角 + 细节相机

---

## 故障排除

### 相机未检测到

**问题：** 相机未出现在设备列表中。

**解决方案：**

**Linux：**
检查系统是否识别相机：

```bash
# 列出视频设备
ls -l /dev/video*

# 使用 v4l2 检查相机
v4l2-ctl --list-devices

# 使用其他应用程序测试
cheese  # 或 VLC 等
```

**对于 Snap 用户：**

```bash
# 授予相机访问权限
sudo snap connect rayforge:camera
```

**Windows：**

- 检查设备管理器中的"相机"或"成像设备"下的相机
- 确保没有其他应用程序正在使用相机（关闭 Zoom、Skype 等）
- 尝试不同的 USB 端口
- 更新相机驱动程序

### 相机显示黑屏

**问题：** 相机检测到但没有图像。

**可能的原因：**

1. **相机被其他应用程序使用** - 关闭其他视频应用程序
2. **选择了错误的设备** - 尝试不同的设备 ID
3. **相机权限** - 在 Linux Snap 上，确保相机接口已连接
4. **硬件问题** - 使用其他应用程序测试相机

**解决方案：**

```bash
# Linux：释放相机设备
sudo killall cheese  # 或其他相机应用程序

# 检查哪个进程正在使用相机
sudo lsof /dev/video0
```

### 对齐不准确

**问题：** 相机叠加与真实激光位置不匹配。

**诊断：**

1. **对齐点不足** - 使用至少 4 个点
2. **测量误差** - 仔细检查世界坐标
3. **相机移动** - 如果相机位置更改，请重新对齐
4. **非线性畸变** - 可能需要镜头校准

**提高精度：**

- 使用更多对齐点（对于非常大的区域，使用 6-8 个）
- 将点分布在整个工作区域
- 非常仔细地测量世界坐标
- 使用机器移动命令精确地将激光定位在已知坐标
- 任何相机调整后重新对齐

### 图像质量差

**问题：** 相机图像模糊、太暗或过亮。

**解决方案：**

1. 在相机设置中**调整亮度/对比度**
2. **改善照明** - 添加一致的工作区域照明
3. **清洁相机镜头** - 灰尘和碎屑会降低清晰度
4. **检查对焦** - 自动对焦可能效果不佳；如可能请使用手动
5. 暂时**降低透明度**以更清楚地看到相机图像
6. **尝试不同的白平衡**设置

### 相机延迟或卡顿

**问题：** 实时相机画面不流畅或延迟。

**解决方案：**

- 在设备设置中降低相机分辨率（如果可访问）
- 关闭其他使用 CPU/GPU 的应用程序
- 更新图形驱动程序
- 在 Linux 上，确保使用 V4L2 后端（Rayforge 中自动）
- 不需要时禁用相机以节省资源

---

## 相关页面

- [模拟模式](../features/simulation-mode) - 使用相机叠加预览执行
- [3D 预览](../ui/3d-preview) - 在 3D 中可视化作业
- [框选作业](../features/framing-your-job) - 验证作业位置
- [常规设置](general) - 机器配置
